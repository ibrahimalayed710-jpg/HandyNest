<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HandyNest - Professional Home Services | New Jersey</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        handy: {
                            primary: '#1E5AA8',
                            dark: '#154785',
                            light: '#3B82F6',
                            accent: '#F59E0B'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        * { 
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Hero Section */
        .hero-landing {
            min-height: 100vh;
            background: linear-gradient(135deg, #1E5AA8 0%, #154785 50%, #0F3460 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-pattern {
            position: absolute;
            inset: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* Logo Animation */
        .logo-container {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        .pulse-ring {
            position: absolute;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /* Trust Badges */
        .trust-badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .trust-badge:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* Service Section */
        .service-section {
            background: #F0F7FF;
            min-height: 100vh;
        }

        .service-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            background: white;
        }

        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(30, 90, 168, 0.25);
            border-color: #1E5AA8;
        }

        .service-card.selected {
            border-color: #1E5AA8;
            background: linear-gradient(135deg, #F0F7FF 0%, #ffffff 100%);
            box-shadow: 0 0 0 4px rgba(30, 90, 168, 0.15);
        }

        .emergency-card {
            background: linear-gradient(135deg, #FEF2F2 0%, #ffffff 100%);
            border-color: #FECACA;
        }

        .emergency-card:hover {
            border-color: #DC2626;
            box-shadow: 0 25px 50px -12px rgba(220, 38, 38, 0.25);
        }

        .emergency-card.selected {
            border-color: #DC2626;
            background: linear-gradient(135deg, #FEF2F2 0%, #ffffff 100%);
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.15);
        }

        /* Form Elements */
        .input-field {
            transition: all 0.2s ease;
            border: 2px solid #E5E7EB;
            font-size: 16px;
        }

        .input-field:focus {
            border-color: #1E5AA8;
            box-shadow: 0 0 0 3px rgba(30, 90, 168, 0.1);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1E5AA8 0%, #154785 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px -10px rgba(30, 90, 168, 0.4);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        /* Selection States */
        .problem-option.selected,
        .time-option.selected {
            background: #1E5AA8;
            color: white;
            border-color: #1E5AA8;
        }

        /* Map */
        #map {
            height: 300px;
            width: 100%;
            border-radius: 12px;
            z-index: 1;
        }

        @media (min-width: 768px) {
            #map {
                height: 400px;
            }
        }

        .custom-pin {
            background: #1E5AA8;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(30, 90, 168, 0.4);
            width: 36px !important;
            height: 36px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        /* Transitions */
        .step-transition { 
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .hidden { 
            display: none !important; 
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255,255,255,0.2);
            z-index: 100;
        }

        .progress-bar {
            background: linear-gradient(90deg, #F59E0B 0%, #ffffff 100%);
            height: 100%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        /* Logo Styling - Fixed */
        .logo-main {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            background: white;
        }

        @media (max-width: 640px) {
            .logo-main {
                width: 140px;
                height: 140px;
            }
        }

        .logo-small {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background: white;
        }

        .logo-medium {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background: white;
        }
    </style>
<base target="_blank">
</head>
<body class="bg-gray-50 font-sans">

    <!-- Progress Bar -->
    <div id="progressContainer" class="progress-container hidden">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
    </div>

    <!-- ==================== LANDING PAGE ==================== -->
    <section id="landingPage" class="hero-landing text-white flex flex-col justify-center items-center relative px-4 py-12">
        <div class="hero-pattern"></div>

        <div class="max-w-4xl mx-auto text-center relative z-10">
            <!-- Logo -->
            <div class="mb-8 relative inline-block">
                <div class="pulse-ring w-48 h-48 md:w-56 md:h-56 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                <div class="pulse-ring w-48 h-48 md:w-56 md:h-56 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" style="animation-delay: 0.5s"></div>

                <div class="logo-container">
                    <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                         alt="HandyNest Logo" 
                         class="logo-main">
                </div>
            </div>

            <!-- Heading -->
            <h1 class="text-3xl md:text-5xl font-bold mb-4 leading-tight">
                Professional Home Services
            </h1>

            <p class="text-lg md:text-xl text-blue-100 mb-8 max-w-2xl mx-auto">
                Fast, reliable, and trusted handymen at your fingertips
            </p>

            <!-- Trust Badges -->
            <div class="flex flex-wrap justify-center gap-3 mb-8">
                <div class="trust-badge px-4 py-2 rounded-full flex items-center gap-2 text-sm">
                    <i class="fas fa-shield-alt text-yellow-400"></i>
                    <span class="font-semibold">Licensed</span>
                </div>
                <div class="trust-badge px-4 py-2 rounded-full flex items-center gap-2 text-sm">
                    <i class="fas fa-bolt text-yellow-400"></i>
                    <span class="font-semibold">Same Day</span>
                </div>
                <div class="trust-badge px-4 py-2 rounded-full flex items-center gap-2 text-sm">
                    <i class="fas fa-star text-yellow-400"></i>
                    <span class="font-semibold">4.9/5 Rating</span>
                </div>
            </div>

            <!-- CTA Button -->
            <button onclick="showServiceSelection()" 
                    class="bg-white text-handy-primary px-8 py-4 rounded-full font-bold text-lg shadow-2xl hover:shadow-white/25 transition-all hover:scale-105 flex items-center gap-2 mx-auto">
                <span>Request Service</span>
                <i class="fas fa-arrow-right"></i>
            </button>

            <!-- Contact Info -->
            <div class="mt-8 flex flex-col items-center gap-2 text-blue-100 text-sm">
                <a href="tel:973-313-5111" class="flex items-center gap-2 hover:text-white transition-colors">
                    <i class="fas fa-phone"></i>
                    <span class="font-semibold">973-313-5111</span>
                </a>
                <span>8 AM - 8 PM Daily</span>
            </div>
        </div>
    </section>

    <!-- ==================== SERVICE SELECTION ==================== -->
    <section id="serviceSelection" class="service-section hidden min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                         alt="HandyNest" 
                         class="logo-small">
                    <div>
                        <h1 class="text-lg font-bold text-handy-primary">HandyNest</h1>
                        <p class="text-xs text-gray-500">Step 1 of 4</p>
                    </div>
                </div>
                <button onclick="backToLanding()" class="text-gray-500 hover:text-handy-primary transition-colors p-2">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">What service do you need?</h2>
                    <p class="text-gray-600 text-sm">Select a category</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div class="service-card rounded-xl p-4 cursor-pointer shadow-sm" onclick="selectService('plumbing')">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-2xl">ðŸš¿</div>
                            <div>
                                <h3 class="font-bold text-gray-900">Plumbing</h3>
                                <p class="text-xs text-gray-500">Leaks, drains, heaters</p>
                            </div>
                        </div>
                    </div>

                    <div class="service-card rounded-xl p-4 cursor-pointer shadow-sm" onclick="selectService('electrical')">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center text-2xl">âš¡</div>
                            <div>
                                <h3 class="font-bold text-gray-900">Electrical</h3>
                                <p class="text-xs text-gray-500">Wiring, panels</p>
                            </div>
                        </div>
                    </div>

                    <div class="service-card rounded-xl p-4 cursor-pointer shadow-sm" onclick="selectService('handyman')">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-2xl">ðŸ”§</div>
                            <div>
                                <h3 class="font-bold text-gray-900">Handyman</h3>
                                <p class="text-xs text-gray-500">Repairs, assembly</p>
                            </div>
                        </div>
                    </div>

                    <div class="service-card emergency-card rounded-xl p-4 cursor-pointer shadow-sm" onclick="selectService('emergency')">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center text-2xl">ðŸš¨</div>
                            <div>
                                <h3 class="font-bold text-red-600">Emergency</h3>
                                <p class="text-xs text-red-500">24/7 urgent</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== STEP 2 ==================== -->
    <section id="step2" class="service-section hidden min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-3 mb-6">
                <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                     alt="HandyNest" 
                     class="logo-small">
                <div>
                    <h1 class="text-lg font-bold text-handy-primary">HandyNest</h1>
                    <p class="text-xs text-gray-500">Step 2 of 4</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-6 step-transition">
                <button onclick="goToStep(1)" class="text-handy-primary hover:text-handy-dark font-medium mb-4 flex items-center gap-2 text-sm">
                    <i class="fas fa-arrow-left"></i> Back
                </button>

                <h2 class="text-xl font-bold text-gray-900 mb-2">Describe the problem</h2>
                <p class="text-gray-600 text-sm mb-4">Select the specific issue</p>

                <div id="problemOptions" class="grid grid-cols-1 gap-2 mb-4"></div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Additional details</label>
                    <textarea id="additionalDetails" class="input-field w-full p-3 rounded-xl resize-none bg-gray-50 text-sm" rows="3" 
                        placeholder="Any additional details..."></textarea>
                </div>

                <button onclick="goToStep(3)" class="btn-primary w-full py-3 rounded-xl text-white font-bold shadow-lg">
                    Continue <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- ==================== STEP 3 ==================== -->
    <section id="step3" class="service-section hidden min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-3 mb-6">
                <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                     alt="HandyNest" 
                     class="logo-small">
                <div>
                    <h1 class="text-lg font-bold text-handy-primary">HandyNest</h1>
                    <p class="text-xs text-gray-500">Step 3 of 4</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-6 step-transition">
                <button onclick="goToStep(2)" class="text-handy-primary hover:text-handy-dark font-medium mb-4 flex items-center gap-2 text-sm">
                    <i class="fas fa-arrow-left"></i> Back
                </button>

                <h2 class="text-xl font-bold text-gray-900 mb-2">Your details & location</h2>
                <p class="text-gray-600 text-sm mb-4">We'll send a technician to you</p>

                <!-- Contact Info -->
                <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm">
                        <i class="fas fa-user text-handy-primary"></i> Contact Information
                    </h3>

                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Full Name *</label>
                            <input type="text" id="fullName" class="input-field w-full p-3 rounded-xl bg-white text-sm" 
                                placeholder="Enter your full name" required>
                        </div>

                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Phone Number *</label>
                            <input type="tel" id="phoneNumber" class="input-field w-full p-3 rounded-xl bg-white text-sm" 
                                placeholder="(555) 123-4567" required>
                        </div>

                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Email</label>
                            <input type="email" id="email" class="input-field w-full p-3 rounded-xl bg-white text-sm" 
                                placeholder="your.email@example.com">
                        </div>
                    </div>
                </div>

                <!-- Location -->
                <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm">
                        <i class="fas fa-map-marker-alt text-handy-primary"></i> Service Location
                    </h3>

                    <div class="flex gap-2 mb-3">
                        <button onclick="getCurrentLocation()" id="gpsBtn" 
                            class="flex-1 bg-handy-primary hover:bg-handy-dark text-white py-3 px-3 rounded-xl font-medium text-xs transition-colors flex items-center justify-center gap-2 shadow-md active:scale-95">
                            <i class="fas fa-location-arrow"></i> <span>Use My Location</span>
                        </button>
                        <button onclick="focusMap()" 
                            class="flex-1 bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-200 py-3 px-3 rounded-xl font-medium text-xs transition-colors flex items-center justify-center gap-2 active:scale-95">
                            <i class="fas fa-map"></i> Pick on Map
                        </button>
                    </div>

                    <div class="mb-3 relative">
                        <input type="text" id="manualAddress" class="input-field w-full p-3 rounded-xl pr-10 bg-white text-sm" 
                            placeholder="Type address...">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400 text-sm"></i>
                        <div id="addressSuggestions" class="hidden absolute w-full bg-white border border-gray-200 rounded-xl mt-1 shadow-lg max-h-40 overflow-y-auto z-50"></div>
                    </div>

                    <div id="map" class="mb-3 border-2 border-gray-200"></div>

                    <div id="selectedAddress" class="hidden bg-green-50 border border-green-200 rounded-xl p-3 flex items-start gap-2">
                        <i class="fas fa-check-circle text-green-600 mt-0.5 text-sm"></i>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-green-900 text-xs">Location confirmed</p>
                            <p id="addressText" class="text-green-800 text-xs mt-0.5 truncate"></p>
                        </div>
                        <button onclick="clearLocation()" class="text-green-400 hover:text-green-600 p-1">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- When -->
                <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-100">
                    <h3 class="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm">
                        <i class="fas fa-clock text-handy-primary"></i> When?
                    </h3>

                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="selectTime('asap')" class="time-option py-3 px-2 rounded-xl border-2 border-gray-200 font-medium text-center bg-white hover:border-handy-primary text-xs" data-time="asap">
                            <i class="fas fa-bolt block mb-1 text-yellow-500"></i>
                            <span>ASAP</span>
                        </button>
                        <button onclick="selectTime('today')" class="time-option py-3 px-2 rounded-xl border-2 border-gray-200 font-medium text-center bg-white hover:border-handy-primary text-xs" data-time="today">
                            <i class="fas fa-sun block mb-1 text-yellow-500"></i>
                            <span>Today</span>
                        </button>
                        <button onclick="selectTime('schedule')" class="time-option py-3 px-2 rounded-xl border-2 border-gray-200 font-medium text-center bg-white hover:border-handy-primary text-xs" data-time="schedule">
                            <i class="fas fa-calendar block mb-1 text-yellow-500"></i>
                            <span>Schedule</span>
                        </button>
                    </div>

                    <div id="schedulePicker" class="hidden mt-3">
                        <input type="datetime-local" id="scheduledTime" class="input-field w-full p-3 rounded-xl bg-white text-sm">
                    </div>
                </div>

                <button onclick="validateAndProceed()" class="btn-primary w-full py-3 rounded-xl text-white font-bold shadow-lg">
                    Review Request <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- ==================== STEP 4 ==================== -->
    <section id="step4" class="service-section hidden min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-3 mb-6">
                <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                     alt="HandyNest" 
                     class="logo-small">
                <div>
                    <h1 class="text-lg font-bold text-handy-primary">HandyNest</h1>
                    <p class="text-xs text-gray-500">Step 4 of 4</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-6 step-transition">
                <button onclick="goToStep(3)" class="text-handy-primary hover:text-handy-dark font-medium mb-4 flex items-center gap-2 text-sm">
                    <i class="fas fa-arrow-left"></i> Back
                </button>

                <h2 class="text-xl font-bold text-gray-900 mb-2">Review</h2>
                <p class="text-gray-600 text-sm mb-4">Confirm your details</p>

                <div class="bg-gray-50 rounded-xl overflow-hidden mb-4 border border-gray-100 text-sm">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-gray-900">Service</h3>
                            <button onclick="goToStep(1)" class="text-handy-primary text-xs">Edit</button>
                        </div>
                        <div class="flex justify-between py-1">
                            <span class="text-gray-600">Type:</span>
                            <span id="reviewService" class="font-semibold capitalize"></span>
                        </div>
                        <div class="flex justify-between py-1">
                            <span class="text-gray-600">Problem:</span>
                            <span id="reviewProblem" class="font-semibold text-right max-w-[60%]"></span>
                        </div>
                    </div>

                    <div class="p-4 border-b border-gray-200 bg-white">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-gray-900">Contact</h3>
                            <button onclick="goToStep(3)" class="text-handy-primary text-xs">Edit</button>
                        </div>
                        <div class="flex justify-between py-1">
                            <span class="text-gray-600">Name:</span>
                            <span id="reviewName" class="font-semibold"></span>
                        </div>
                        <div class="flex justify-between py-1">
                            <span class="text-gray-600">Phone:</span>
                            <span id="reviewPhone" class="font-semibold"></span>
                        </div>
                    </div>

                    <div class="p-4 border-b border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-gray-900">Location</h3>
                            <button onclick="goToStep(3)" class="text-handy-primary text-xs">Edit</button>
                        </div>
                        <p id="reviewAddress" class="text-gray-900 font-medium text-xs mb-1 line-clamp-2"></p>
                    </div>

                    <div class="p-4 bg-white">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-gray-900">Time</h3>
                            <button onclick="goToStep(3)" class="text-handy-primary text-xs">Edit</button>
                        </div>
                        <p id="reviewTime" class="text-handy-primary font-medium text-xs bg-handy-primary/10 inline-block px-3 py-1 rounded-lg"></p>
                    </div>
                </div>

                <button onclick="submitRequest()" id="submitBtn" class="btn-primary w-full py-3 rounded-xl text-white font-bold shadow-lg flex items-center justify-center gap-2">
                    <span>Submit Request</span>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- ==================== THANK YOU PAGE ==================== -->
    <section id="thankYou" class="service-section hidden min-h-screen py-8 px-4 flex items-center justify-center">
        <div class="max-w-md mx-auto text-center">
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <img src="https://res.cloudinary.com/dqypbihru/image/upload/v1770902936/5796199413138001198_1_mg8yqq.png" 
                     alt="HandyNest" 
                     class="logo-medium mx-auto mb-4">

                <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-2xl text-green-600"></i>
                </div>

                <h2 class="text-2xl font-bold text-gray-900 mb-2">Success! ðŸŽ‰</h2>
                <p class="text-gray-600 text-sm mb-6">
                    Your request has been submitted. We'll contact you shortly.
                </p>

                <div class="bg-gray-50 rounded-xl p-4 mb-6 text-left">
                    <a href="tel:973-313-5111" class="flex items-center gap-3 text-gray-700 p-2 rounded-lg hover:bg-white transition-colors">
                        <div class="w-10 h-10 bg-handy-primary/10 rounded-full flex items-center justify-center">
                            <i class="fas fa-phone text-handy-primary"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Call Us</p>
                            <p class="font-semibold text-sm">973-313-5111</p>
                        </div>
                    </a>
                </div>

                <button onclick="location.reload()" class="btn-primary px-6 py-3 rounded-xl text-white font-bold shadow-lg text-sm">
                    <i class="fas fa-plus-circle mr-2"></i> New Request
                </button>
            </div>
        </div>
    </section>

    <script>
        // Application State
        const state = {
            currentStep: 1,
            serviceType: '',
            problemType: '',
            additionalDetails: '',
            fullName: '',
            phoneNumber: '',
            email: '',
            fullAddress: '',
            latitude: null,
            longitude: null,
            preferredTime: '',
            scheduledTime: null
        };

        const serviceProblems = {
            plumbing: [
                { id: 'leak', label: 'Leak', icon: 'ðŸ’§' },
                { id: 'clogged_drain', label: 'Clogged Drain', icon: 'ðŸš¿' },
                { id: 'water_heater', label: 'Water Heater', icon: 'ðŸ”¥' },
                { id: 'pipe_repair', label: 'Pipe Repair', icon: 'ðŸ”§' },
                { id: 'other', label: 'Other', icon: 'ðŸ› ï¸' }
            ],
            electrical: [
                { id: 'power_outage', label: 'Power Outage', icon: 'âš¡' },
                { id: 'wiring', label: 'Wiring Issue', icon: 'ðŸ”Œ' },
                { id: 'light_switch', label: 'Light/Switch', icon: 'ðŸ’¡' },
                { id: 'panel_breaker', label: 'Panel/Breaker', icon: 'âš™ï¸' },
                { id: 'other', label: 'Other', icon: 'ðŸ› ï¸' }
            ],
            handyman: [
                { id: 'furniture', label: 'Furniture Assembly', icon: 'ðŸª‘' },
                { id: 'mounting', label: 'Wall Mounting', icon: 'ðŸ–¼ï¸' },
                { id: 'door_lock', label: 'Door/Lock Repair', icon: 'ðŸšª' },
                { id: 'minor_repairs', label: 'Minor Repairs', icon: 'ðŸ”¨' },
                { id: 'other', label: 'Other', icon: 'ðŸ› ï¸' }
            ],
            emergency: [
                { id: 'water_emergency', label: 'Water Emergency', icon: 'ðŸŒŠ' },
                { id: 'electrical_emergency', label: 'Electrical Emergency', icon: 'âš¡' },
                { id: 'lock_emergency', label: 'Lock Emergency', icon: 'ðŸ”' },
                { id: 'other', label: 'Other Emergency', icon: 'ðŸš¨' }
            ]
        };

        let map, marker;
        let debounceTimer;

        function showServiceSelection() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('serviceSelection').classList.remove('hidden');
            document.getElementById('progressContainer').classList.remove('hidden');
            updateProgressBar();
            window.scrollTo(0, 0);
        }

        function backToLanding() {
            document.getElementById('serviceSelection').classList.add('hidden');
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('progressContainer').classList.add('hidden');
            window.scrollTo(0, 0);
        }

        function goToStep(step) {
            document.getElementById('serviceSelection').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');

            const targetId = step === 1 ? 'serviceSelection' : `step${step}`;
            const target = document.getElementById(targetId);
            target.classList.remove('hidden');
            target.classList.add('step-transition');

            window.scrollTo(0, 0);
            state.currentStep = step;
            updateProgressBar();

            if (step === 2) renderProblemOptions();
            if (step === 3) setTimeout(initMap, 100);
            if (step === 4) populateReview();
        }

        function updateProgressBar() {
            const progress = ((state.currentStep) / 4) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function selectService(service) {
            state.serviceType = service;
            document.querySelectorAll('.service-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            setTimeout(() => goToStep(2), 200);
        }

        function renderProblemOptions() {
            const container = document.getElementById('problemOptions');
            const problems = serviceProblems[state.serviceType] || [];

            container.innerHTML = problems.map(prob => `
                <button onclick="selectProblem('${prob.id}', '${prob.label}')" 
                    class="problem-option w-full p-3 rounded-xl border-2 border-gray-200 text-left flex items-center gap-3 bg-white text-sm hover:shadow-md transition-all"
                    data-problem="${prob.id}">
                    <span class="text-xl">${prob.icon}</span>
                    <span class="font-medium">${prob.label}</span>
                </button>
            `).join('');
        }

        function selectProblem(id, label) {
            state.problemType = label;
            document.querySelectorAll('.problem-option').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        function initMap() {
            if (map) {
                map.invalidateSize();
                return;
            }

            const defaultLoc = [40.0583, -74.4057];
            map = L.map('map', {
                zoomControl: false,
                attributionControl: false
            }).setView(defaultLoc, 12);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19
            }).addTo(map);

            L.control.zoom({
                position: 'bottomright'
            }).addTo(map);

            const customIcon = L.divIcon({
                className: 'custom-pin',
                html: '<i class="fas fa-home"></i>',
                iconSize: [36, 36],
                iconAnchor: [18, 36]
            });

            marker = L.marker(defaultLoc, {
                draggable: true,
                icon: customIcon
            }).addTo(map);

            marker.on('dragend', async (e) => {
                const pos = e.target.getLatLng();
                await reverseGeocode(pos.lat, pos.lng);
            });

            map.on('click', async (e) => {
                marker.setLatLng(e.latlng);
                await reverseGeocode(e.latlng.lat, e.latlng.lng);
            });
        }

        async function reverseGeocode(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
                );
                const data = await response.json();
                if (data.display_name) updateMapLocation(lat, lng, data.display_name);
            } catch (error) {
                console.error('Reverse geocoding error:', error);
            }
        }

        function updateMapLocation(lat, lng, address) {
            state.latitude = lat;
            state.longitude = lng;
            state.fullAddress = address;

            if (marker) {
                marker.setLatLng([lat, lng]);
                map.setView([lat, lng], 16);
            }

            document.getElementById('manualAddress').value = address;
            document.getElementById('selectedAddress').classList.remove('hidden');
            document.getElementById('addressText').textContent = address;
            marker.bindPopup(`<b>Location</b><br>${address}`).openPopup();
        }

        async function searchAddress(query) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&countrycodes=us`
                );
                const data = await response.json();
                displaySuggestions(data);
            } catch (error) {
                console.error('Geocoding error:', error);
            }
        }

        function displaySuggestions(results) {
            const container = document.getElementById('addressSuggestions');
            if (results.length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.innerHTML = results.map(place => `
                <div onclick="selectSuggestion('${place.display_name.replace(/'/g, "\'")}', ${place.lat}, ${place.lon})" 
                    class="p-3 hover:bg-handy-primary/10 cursor-pointer border-b border-gray-100 last:border-0 text-xs transition-colors">
                    <i class="fas fa-map-marker-alt text-handy-primary mr-2"></i>
                    ${place.display_name}
                </div>
            `).join('');
            container.classList.remove('hidden');
        }

        function selectSuggestion(displayName, lat, lon) {
            document.getElementById('manualAddress').value = displayName;
            document.getElementById('addressSuggestions').classList.add('hidden');
            updateMapLocation(parseFloat(lat), parseFloat(lon), displayName);
        }

        function getCurrentLocation() {
            const btn = document.getElementById('gpsBtn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Locating...';
            btn.disabled = true;

            if (!navigator.geolocation) {
                alert('Geolocation not supported');
                resetGpsButton(btn, originalContent);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    await reverseGeocode(lat, lng);
                    resetGpsButton(btn, originalContent);
                },
                (error) => {
                    alert('Could not get location. Please check permissions.');
                    resetGpsButton(btn, originalContent);
                }
            );
        }

        function resetGpsButton(btn, content) {
            btn.innerHTML = content;
            btn.disabled = false;
        }

        function focusMap() {
            document.getElementById('map').scrollIntoView({ behavior: 'smooth', block: 'center' });
            if (map) map.invalidateSize();
        }

        function clearLocation() {
            state.fullAddress = '';
            state.latitude = null;
            state.longitude = null;
            document.getElementById('selectedAddress').classList.add('hidden');
            document.getElementById('manualAddress').value = '';
        }

        function selectTime(time) {
            state.preferredTime = time;
            document.querySelectorAll('.time-option').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            const picker = document.getElementById('schedulePicker');
            if (time === 'schedule') {
                picker.classList.remove('hidden');
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('scheduledTime').min = now.toISOString().slice(0, 16);
            } else {
                picker.classList.add('hidden');
            }
        }

        function validateAndProceed() {
            const fullName = document.getElementById('fullName').value.trim();
            const phoneNumber = document.getElementById('phoneNumber').value.trim();

            if (!fullName) {
                alert('Please enter your name');
                document.getElementById('fullName').focus();
                return;
            }

            if (!phoneNumber) {
                alert('Please enter your phone');
                document.getElementById('phoneNumber').focus();
                return;
            }

            if (!state.fullAddress) {
                alert('Please select location');
                focusMap();
                return;
            }

            if (!state.preferredTime) {
                alert('Please select when');
                return;
            }

            state.fullName = fullName;
            state.phoneNumber = phoneNumber;
            state.email = document.getElementById('email').value.trim();
            state.additionalDetails = document.getElementById('additionalDetails').value.trim();

            if (state.preferredTime === 'schedule') {
                state.scheduledTime = document.getElementById('scheduledTime').value;
                if (!state.scheduledTime) {
                    alert('Please select date/time');
                    return;
                }
            }

            goToStep(4);
        }

        function populateReview() {
            document.getElementById('reviewService').textContent = state.serviceType;
            document.getElementById('reviewProblem').textContent = state.problemType;
            document.getElementById('reviewName').textContent = state.fullName;
            document.getElementById('reviewPhone').textContent = state.phoneNumber;
            document.getElementById('reviewAddress').textContent = state.fullAddress;

            const timeLabels = {
                'asap': 'ASAP',
                'today': 'Today',
                'schedule': state.scheduledTime ? new Date(state.scheduledTime).toLocaleString() : 'Scheduled'
            };
            document.getElementById('reviewTime').textContent = timeLabels[state.preferredTime];
        }

        async function submitRequest() {
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
            submitBtn.disabled = true;

            await new Promise(resolve => setTimeout(resolve, 1500));

            document.getElementById('step4').classList.add('hidden');
            document.getElementById('thankYou').classList.remove('hidden');
            document.getElementById('progressContainer').classList.add('hidden');
            window.scrollTo(0, 0);
        }

        document.getElementById('manualAddress')?.addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            const query = e.target.value.trim();
            if (query.length < 3) {
                document.getElementById('addressSuggestions').classList.add('hidden');
                return;
            }
            debounceTimer = setTimeout(() => searchAddress(query), 500);
        });

        document.addEventListener('click', (e) => {
            const input = document.getElementById('manualAddress');
            const suggestions = document.getElementById('addressSuggestions');
            if (input && suggestions && !input.contains(e.target) && !suggestions.contains(e.target)) {
                suggestions.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
